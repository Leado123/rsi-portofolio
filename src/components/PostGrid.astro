---
interface Post {
  id: number;
  title: { rendered: string };
  date: string;
  excerpt: { rendered: string };
  link: string;
  _embedded?: {
    'wp:featuredmedia'?: Array<{
      source_url: string;
    }>;
    'wp:term'?: Array<Array<{
      name: string;
      taxonomy: string;
    }>>;
  };
}

interface Props {
  posts: Post[];
}

const { posts } = Astro.props;
---

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 p-4">
  {posts.map((post) => {
    // Ensure image URLs use HTTPS to prevent mixed content warnings
    const rawImage = post._embedded?.['wp:featuredmedia']?.[0]?.source_url;
    const image = rawImage ? rawImage.replace(/^http:\/\//, 'https://') : null;
    
    // Ensure post link uses HTTPS
    const postLink = post.link ? post.link.replace(/^http:\/\//, 'https://') : post.link;
    
    // Ensure title and excerpt content URLs use HTTPS
    const title = post.title.rendered ? post.title.rendered.replace(/http:\/\//g, 'https://') : post.title.rendered;
    const excerpt = post.excerpt.rendered ? post.excerpt.rendered.replace(/http:\/\//g, 'https://') : post.excerpt.rendered;
    
    const date = new Date(post.date).toLocaleDateString();
    
    return (
      <article class="border rounded-lg p-4 bg-white/10 backdrop-blur-sm hover:bg-white/20 transition-colors">
        {image && (
          <img 
            src={image} 
            alt={post.title.rendered}
            class="w-full h-48 object-cover rounded-md mb-4"
          />
        )}
        <div class="flex flex-col gap-2">
          <span class="text-sm opacity-70">{date}</span>
          <h2 class="text-xl font-bold" set:html={title} />
          <div class="text-sm opacity-90" set:html={excerpt} />
          <a 
            href={postLink} 
            target="_blank" 
            rel="noopener noreferrer"
            class="mt-2 text-blue-400 hover:text-blue-300 inline-block"
          >
            Read more &rarr;
          </a>
        </div>
      </article>
    );
  })}
</div>